<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Jamza">





<title>macvlan 虚拟技术的 bridge 模式 | Jamza&#39;s Blog</title>



    <link rel="icon" href="/image/head.jpg">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Jamza&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Jamza&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">macvlan 虚拟技术的 bridge 模式</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Jamza</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">五月 22, 2021&nbsp;&nbsp;11:20:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF/">网络技术</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="macvlan-虚拟技术的-bridge-模式"><a href="#macvlan-虚拟技术的-bridge-模式" class="headerlink" title="macvlan 虚拟技术的 bridge 模式"></a>macvlan 虚拟技术的 bridge 模式</h1><p>macvlan 是 Linux 操作系统内核提供的网络虚拟化方案之一，是网卡虚拟化解决方案。macvlan 可以将一张物理网卡设置多个 mac 地址，相当于将物理网卡实施分身术，要求物理网卡打开混杂模式。针对每个 mac 地址，都可以设置 IP 地址。因此，本来是一块物理网卡连接到交换机，现在可以是多块虚拟网卡连接到交换机了。</p>
<p>macvlan 并不创建网络，只是创建虚拟网卡，而通过 macvlan 虚拟出多个虚拟网卡，目的是在多租户场景下，在统一的底层网络基础上，单独为每一个租户虚拟出自己的网络，从而实现网络隔离的目的。</p>
<h2 id="物理网卡设置混杂模式"><a href="#物理网卡设置混杂模式" class="headerlink" title="物理网卡设置混杂模式"></a>物理网卡设置混杂模式</h2><p>对于物理网络，需要打开混杂模式。在打开混杂模式之前，eth0 接口，状态为：&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>通过命令，打开混杂模式，eth0 端口状态为 &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt;，多出来的 PROMISC 表示已经打开混杂模式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ifconfig eth0 promisc</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>如果需要关闭混杂模式，执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ifconfig eth0 -promisc</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="内核加载-macvlan-驱动模块"><a href="#内核加载-macvlan-驱动模块" class="headerlink" title="内核加载 macvlan 驱动模块"></a>内核加载 macvlan 驱动模块</h2><p>macvlan 是 Linux 内核提供的一种网络驱动类型。如果内核没有加载 macvlan，可以通过命令加载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># lsmod | grep macvlan</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># modprobe macvlan</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># lsmod | grep macvlan</span></span><br><span class="line">macvlan                19233  0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>如果卸载 macvlan，可以执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># lsmod | grep macvlan</span></span><br><span class="line">macvlan                19233  0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># modprobe -r macvlan</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># lsmod | grep macvlan</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="创建配置-macvlan-网络"><a href="#创建配置-macvlan-网络" class="headerlink" title="创建配置 macvlan 网络"></a>创建配置 macvlan 网络</h2><p>创建两个虚拟网卡，macvlan 模式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link add link eth0 name eth0.01 type macvlan mode bridge</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link add link eth0 name eth0.02 type macvlan mode bridge</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">61: eth0.01@eth0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 3e:<span class="built_in">fc</span>:ba:a6:af:68 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">62: eth0.02@eth0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether ba:ea:35:91:37:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>可以看出，多出了两个虚拟网卡，名称分别为 eth0.01@eth0 与 eth0.02@eth0，但是虚拟网卡的状态没有 UP，需要激活虚拟网卡：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip link set eth0.01 up</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link set eth0.02 up</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">61: eth0.01@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 3e:<span class="built_in">fc</span>:ba:a6:af:68 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">62: eth0.02@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether ba:ea:35:91:37:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ifconfig eth0.01</span></span><br><span class="line">eth0.01: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet6 fe80::3cfc:baff:fea6:af68  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 3e:<span class="built_in">fc</span>:ba:a6:af:68  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 8  bytes 648 (648.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ifconfig eth0.02</span></span><br><span class="line">eth0.02: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet6 fe80::b8ea:35ff:fe91:372a  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether ba:ea:35:91:37:2a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 2  bytes 168 (168.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 8  bytes 648 (648.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>虚拟网卡已经 UP，但是只有 mac 地址，还没有 ip 地址。</p>
<p>创建两个网络命名空间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns add ns01</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns add ns02</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns</span></span><br><span class="line">ns02</span><br><span class="line">ns01</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>将虚拟网卡 eth0.01 添加到网络命名空间 ns01 中，将虚拟网卡 eth0.02 添加到网络命名空间 ns02 中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip link set eth0.01 netns ns01</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link set eth0.02 netns ns02</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>给两个虚拟网卡配置 ip 地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ip addr add 192.168.83.101/24 dev eth0.01</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ip addr add 192.168.83.102/24 dev eth0.02</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>查看 ip 地址的配置情况，从结果可以看出，只有在命令空间 ns01 中才能看到虚拟网卡 eth0.01，也只有在命令空间 ns02 中才能看到虚拟网卡 eth0.02：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ifconfig eth0.01</span></span><br><span class="line">eth0.01: error fetching interface information: Device not found</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ifconfig eth0.02</span></span><br><span class="line">eth0.02: error fetching interface information: Device not found</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ifconfig eth0.01</span></span><br><span class="line">eth0.01: flags=4098&lt;BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.101  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 3e:<span class="built_in">fc</span>:ba:a6:af:68  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 8  bytes 648 (648.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ifconfig eth0.02</span></span><br><span class="line">eth0.02: flags=4098&lt;BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.102  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether ba:ea:35:91:37:2a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 2  bytes 168 (168.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 8  bytes 648 (648.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ifconfig eth0.02</span></span><br><span class="line">eth0.02: error fetching interface information: Device not found</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ifconfig eth0.01</span></span><br><span class="line">eth0.01: error fetching interface information: Device not found</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>设置虚拟网卡 up：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">61: eth0.01@if2: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 3e:<span class="built_in">fc</span>:ba:a6:af:68 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ip link set lo up</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ip link set eth0.01 up</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ifconfig</span></span><br><span class="line">eth0.01: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.101  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::3cfc:baff:fea6:af68  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 3e:<span class="built_in">fc</span>:ba:a6:af:68  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 16  bytes 1296 (1.2 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">62: eth0.02@if2: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether ba:ea:35:91:37:2a brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ip link set lo up</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ip link set eth0.02 up</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ifconfig</span></span><br><span class="line">eth0.02: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.102  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::b8ea:35ff:fe91:372a  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether ba:ea:35:91:37:2a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 2  bytes 168 (168.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 15  bytes 1226 (1.1 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="PING-测试"><a href="#PING-测试" class="headerlink" title="PING 测试"></a>PING 测试</h2><p>ping 宿主 eth0 端口，以及宿主机的网桥端口，macvlan 网络 bridge 模式下，与物理网卡端口无法 ping 通，与交换机网桥可以 ping 通</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ping 192.168.83.83</span></span><br><span class="line">PING 192.168.83.83 (192.168.83.83) 56(84) bytes of data.</span><br><span class="line">^Z</span><br><span class="line">[4]+  Stopped                 ip netns <span class="built_in">exec</span> ns01 ping 192.168.83.83</span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ping 192.168.83.83</span></span><br><span class="line">PING 192.168.83.83 (192.168.83.83) 56(84) bytes of data.</span><br><span class="line">^Z</span><br><span class="line">[5]+  Stopped                 ip netns <span class="built_in">exec</span> ns02 ping 192.168.83.83</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ping 192.168.83.1</span></span><br><span class="line">PING 192.168.83.1 (192.168.83.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.83.1: icmp_seq=1 ttl=64 time=0.510 ms</span><br><span class="line">64 bytes from 192.168.83.1: icmp_seq=2 ttl=64 time=0.235 ms</span><br><span class="line">64 bytes from 192.168.83.1: icmp_seq=3 ttl=64 time=0.356 ms</span><br><span class="line">^Z</span><br><span class="line">[6]+  Stopped                 ip netns <span class="built_in">exec</span> ns01 ping 192.168.83.1</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ping 192.168.83.1</span></span><br><span class="line">PING 192.168.83.1 (192.168.83.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.83.1: icmp_seq=1 ttl=64 time=0.287 ms</span><br><span class="line">64 bytes from 192.168.83.1: icmp_seq=2 ttl=64 time=0.219 ms</span><br><span class="line">64 bytes from 192.168.83.1: icmp_seq=3 ttl=64 time=0.377 ms</span><br><span class="line">^Z</span><br><span class="line">[7]+  Stopped                 ip netns <span class="built_in">exec</span> ns02 ping 192.168.83.1</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>不同命名空间，同物理网卡的虚拟网卡之间，是可以 ping 通的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ping 192.168.83.101</span></span><br><span class="line">PING 192.168.83.101 (192.168.83.101) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=1 ttl=64 time=1.44 ms</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=2 ttl=64 time=0.101 ms</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=3 ttl=64 time=0.106 ms</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=4 ttl=64 time=0.107 ms</span><br><span class="line">^Z</span><br><span class="line">[8]+  Stopped                 ip netns <span class="built_in">exec</span> ns02 ping 192.168.83.101</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns02 ping 192.168.83.102</span></span><br><span class="line">PING 192.168.83.102 (192.168.83.102) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=1 ttl=64 time=0.041 ms</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=2 ttl=64 time=0.103 ms</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=3 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=4 ttl=64 time=0.099 ms</span><br><span class="line">^Z</span><br><span class="line">[9]+  Stopped                 ip netns <span class="built_in">exec</span> ns02 ping 192.168.83.102</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ping 192.168.83.102</span></span><br><span class="line">PING 192.168.83.102 (192.168.83.102) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=1 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=2 ttl=64 time=0.063 ms</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=3 ttl=64 time=0.062 ms</span><br><span class="line">64 bytes from 192.168.83.102: icmp_seq=4 ttl=64 time=0.061 ms</span><br><span class="line">^Z</span><br><span class="line">[10]+  Stopped                 ip netns <span class="built_in">exec</span> ns01 ping 192.168.83.102</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns exec ns01 ping 192.168.83.101</span></span><br><span class="line">PING 192.168.83.101 (192.168.83.101) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=1 ttl=64 time=0.032 ms</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=2 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=3 ttl=64 time=0.049 ms</span><br><span class="line">64 bytes from 192.168.83.101: icmp_seq=4 ttl=64 time=0.049 ms</span><br><span class="line">^Z</span><br><span class="line">[11]+  Stopped                 ip netns <span class="built_in">exec</span> ns01 ping 192.168.83.101</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="删除虚拟网卡与网络命名空间"><a href="#删除虚拟网卡与网络命名空间" class="headerlink" title="删除虚拟网卡与网络命名空间"></a>删除虚拟网卡与网络命名空间</h2><p>删除虚拟网卡：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">63: eth0.01@eth0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether f2:75:b6:f9:af:5e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">64: eth0.02@eth0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 76:1c:5a:15:50:35 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link delete eth0.01</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link delete eth0.02</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:00 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: eth20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:20 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: eth21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</span><br><span class="line">    link/ether 52:54:83:aa:bb:21 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT</span><br><span class="line">    link/ether 02:42:02:92:51:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: docker_gwbridge: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT</span><br><span class="line">    link/ether 02:42:9f:6e:6a:5d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">60: vethe5c91d3@if59: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT</span><br><span class="line">    link/ether c6:8b:1b:b9:1f:fd brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>删除网络命名空间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns help</span></span><br><span class="line">Usage: ip netns list</span><br><span class="line">       ip netns add NAME</span><br><span class="line">       ip netns <span class="built_in">set</span> NAME NETNSID</span><br><span class="line">       ip [-all] netns delete [NAME]</span><br><span class="line">       ip netns identify [PID]</span><br><span class="line">       ip netns pids NAME</span><br><span class="line">       ip [-all] netns <span class="built_in">exec</span> [NAME] cmd ...</span><br><span class="line">       ip netns monitor</span><br><span class="line">       ip netns list-id</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns</span></span><br><span class="line">ns02</span><br><span class="line">ns01</span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns delete ns01</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns delete ns02</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment"># ip netns</span></span><br><span class="line">[root@vac_master0 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
        </div>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/macvlan/"># macvlan</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2021/05/22/unix%20domain%20socket%20%E7%9A%84%20udp%20%E9%80%9A%E4%BF%A1/">unix domain socket 的 UDP 通信</a>
            
            
            <a class="next" rel="next" href="/2021/05/22/diff%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B/">diff命令使用简介</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Jamza | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
