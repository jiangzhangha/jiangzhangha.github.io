<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Jamza">





<title>自定义网络实现跨主机 Docker 通信 | Jamza&#39;s Blog</title>



    <link rel="icon" href="/image/head.jpg">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Jamza&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Jamza&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">自定义网络实现跨主机 Docker 通信</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Jamza</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">May 22, 2021&nbsp;&nbsp;12:04:12</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="自定义网络实现跨主机-Docker-通信"><a href="#自定义网络实现跨主机-Docker-通信" class="headerlink" title="自定义网络实现跨主机 Docker 通信"></a>自定义网络实现跨主机 Docker 通信</h1><h2 id="环境参数分配"><a href="#环境参数分配" class="headerlink" title="环境参数分配"></a>环境参数分配</h2><h3 id="主控-master"><a href="#主控-master" class="headerlink" title="主控 master"></a>主控 master</h3><p>宿主机 ip：eth0 192.168.83.83</p>
<p>容器分配网段：172.172.0.0/24</p>
<p>启动容器指定 ip：172.172.0.10</p>
<h3 id="线卡-lp"><a href="#线卡-lp" class="headerlink" title="线卡 lp"></a>线卡 lp</h3><p>宿主机 ip：eth0 192.168.83.85</p>
<p>容器分配网段：172.172.1.0/24</p>
<p>启动容器指定 ip：172.172.1.10</p>
<h2 id="主控宿主机操作"><a href="#主控宿主机操作" class="headerlink" title="主控宿主机操作"></a>主控宿主机操作</h2><p>创建自定义网络之前，主机环境：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@jamza_vm_master_litepaas master]<span class="comment"># ifconfig</span></span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.6.252  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:c6ff:fe05:2363  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:c6:05:23:63  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 562 </span> bytes<span class="number"> 35144 </span>(34.3 KiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 223 </span> bytes<span class="number"> 19338 </span>(18.8 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">docker_gwbridge: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.18.0.1  netmask 255.255.240.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:42ff:fe41:eebc  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:42:41:ee:bc  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 3527525 </span> bytes<span class="number"> 183431812 </span>(174.9 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 15 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 1455 </span> bytes<span class="number"> 93698 </span>(91.5 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.83  netmask 255.255.255.0  broadcast 192.168.83.255</span><br><span class="line">        inet6 fe80::5054:83ff:feaa:bb00  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:aa:bb:00  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 83274207 </span> bytes<span class="number"> 364679223968 </span>(339.6 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 15 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 94593718 </span> bytes<span class="number"> 213226263982 </span>(198.5 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth20: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.84.83  netmask 255.255.255.0  broadcast 192.168.84.255</span><br><span class="line">        inet6 fe80::5054:83ff:feaa:bb20  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:aa:bb:20  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 10557267 </span> bytes<span class="number"> 703540934 </span>(670.9 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 7026900 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 1441 </span> bytes<span class="number"> 92630 </span>(90.4 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth21: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.85.83  netmask 255.255.255.0  broadcast 192.168.85.255</span><br><span class="line">        inet6 fe80::5054:83ff:feaa:bb21  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:aa:bb:21  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 3527525 </span> bytes<span class="number"> 183431812 </span>(174.9 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 15 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 1455 </span> bytes<span class="number"> 93698 </span>(91.5 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen<span class="number"> 128 </span> scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen<span class="number"> 1 </span> (Local Loopback)</span><br><span class="line">        RX packets<span class="number"> 34438746 </span> bytes<span class="number"> 4372079263 </span>(4.0 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 34438746 </span> bytes<span class="number"> 4372079263 </span>(4.0 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">[root@jamza_vm_master_litepaas master]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">a78327e048e0        bridge              bridge              local</span><br><span class="line">b919f69968ec        docker_gwbridge     bridge              local</span><br><span class="line">032c767b11de        host                host                local</span><br><span class="line">cad8d79e6d05        none                null                local</span><br></pre></td></tr></table></figure>

<p>创建自定义网络，指定网桥名称为 docker-br0，当然也可以取其他的名字，指定网桥的网段为 172.172.0.0/24：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="title">@jamza_vm_master_litepaas</span> master]# docker network create --subnet<span class="operator">=</span><span class="number">172.172</span>.<span class="number">0.0</span>/<span class="number">24</span> docker-<span class="keyword">br</span><span class="number">0</span></span><br><span class="line"><span class="number">760119</span>ea<span class="number">59076</span>b<span class="number">90</span>d<span class="number">02</span>d<span class="number">0</span>d<span class="number">8</span>ee<span class="number">69</span>fff<span class="number">176</span>ac<span class="number">07</span>bb<span class="number">30</span>b<span class="number">8</span><span class="keyword">c</span><span class="number">78</span>b<span class="number">4</span>f<span class="number">4466</span>fd<span class="number">7</span><span class="keyword">c</span><span class="number">46</span><span class="keyword">c</span><span class="number">2</span>f<span class="number">1</span>d</span><br><span class="line">[root<span class="title">@jamza_vm_master_litepaas</span> master]#</span><br></pre></td></tr></table></figure>

<p>创建网络后，查看当前主机的网络环境，环境中多出了名称为 br-760119ea5907 的网卡，且 docker 网络出现刚创建的名称为 docker-br0 的网络：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">[root@jamza_vm_master_litepaas master]<span class="comment"># ifconfig</span></span><br><span class="line">br-760119ea5907: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.172.0.1  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 02:42:0c:76:ad:5d  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 10557312 </span> bytes<span class="number"> 703543934 </span>(670.9 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 7026930 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 1441 </span> bytes<span class="number"> 92630 </span>(90.4 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.6.252  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:c6ff:fe05:2363  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:c6:05:23:63  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 562 </span> bytes<span class="number"> 35144 </span>(34.3 KiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 223 </span> bytes<span class="number"> 19338 </span>(18.8 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">docker_gwbridge: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.18.0.1  netmask 255.255.240.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:42ff:fe41:eebc  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:42:41:ee:bc  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 3527540 </span> bytes<span class="number"> 183432592 </span>(174.9 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 15 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 1455 </span> bytes<span class="number"> 93698 </span>(91.5 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.83  netmask 255.255.255.0  broadcast 192.168.83.255</span><br><span class="line">        inet6 fe80::5054:83ff:feaa:bb00  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:aa:bb:00  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 83274510 </span> bytes<span class="number"> 364679281561 </span>(339.6 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 15 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 94593962 </span> bytes<span class="number"> 213226325066 </span>(198.5 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth20: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.84.83  netmask 255.255.255.0  broadcast 192.168.84.255</span><br><span class="line">        inet6 fe80::5054:83ff:feaa:bb20  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:aa:bb:20  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 10557312 </span> bytes<span class="number"> 703543934 </span>(670.9 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 7026930 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 1441 </span> bytes<span class="number"> 92630 </span>(90.4 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth21: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.85.83  netmask 255.255.255.0  broadcast 192.168.85.255</span><br><span class="line">        inet6 fe80::5054:83ff:feaa:bb21  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:aa:bb:21  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 3527540 </span> bytes<span class="number"> 183432592 </span>(174.9 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 15 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 1455 </span> bytes<span class="number"> 93698 </span>(91.5 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen<span class="number"> 128 </span> scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen<span class="number"> 1 </span> (Local Loopback)</span><br><span class="line">        RX packets<span class="number"> 34438790 </span> bytes<span class="number"> 4372081463 </span>(4.0 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 34438790 </span> bytes<span class="number"> 4372081463 </span>(4.0 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">[root@jamza_vm_master_litepaas master]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">a78327e048e0        bridge              bridge              local</span><br><span class="line">760119ea5907        docker-br0          bridge              local</span><br><span class="line">b919f69968ec        docker_gwbridge     bridge              local</span><br><span class="line">032c767b11de        host                host                local</span><br><span class="line">cad8d79e6d05        none                null                local</span><br></pre></td></tr></table></figure>

<p>创建容器，并使用自定义的网络，指定容器内的 ip 地址为 172.172.0.10，查看容器内的网络环境，ip 配置为设定值：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@jamza_vm_master_litepaas master]# docker run -it --net docker-br0 --ip <span class="number">172.172</span>.<span class="number">0.10</span> --name master busybox/x86_64 /bin/<span class="keyword">sh</span></span><br><span class="line">/ # ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:AC:AC:<span class="number">00</span>:<span class="number">0</span>A</span><br><span class="line">          inet addr:<span class="number">172.172</span>.<span class="number">0.10</span>  Bcas<span class="variable">t:0</span>.<span class="number">0.0</span>.<span class="number">0</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">42</span>:acff:feac:<span class="keyword">a</span>/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packet<span class="variable">s:12</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packet<span class="variable">s:6</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> carrier:<span class="number">0</span></span><br><span class="line">          collision<span class="variable">s:0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX byte<span class="variable">s:1016</span> (<span class="number">1016.0</span> B)  TX byte<span class="variable">s:508</span> (<span class="number">508.0</span> B)</span><br><span class="line"></span><br><span class="line"><span class="keyword">lo</span>        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packet<span class="variable">s:0</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packet<span class="variable">s:0</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> carrier:<span class="number">0</span></span><br><span class="line">          collision<span class="variable">s:0</span> txqueuelen:<span class="number">1</span></span><br><span class="line">          RX byte<span class="variable">s:0</span> (<span class="number">0.0</span> B)  TX byte<span class="variable">s:0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在容器内 ping 当前宿主机的网络地址，显示可以 ping 通：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>192.168.83.83<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>192.168.83.83 (192.168.83.83): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.83: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.059 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.83: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.058 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.83: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.064 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.83: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.048 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.83: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.048 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.83.83<span class="built_in"> ping </span>statistics ---</span><br><span class="line">5 packets transmitted, 5 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.048/0.055/0.064 ms</span><br><span class="line">/ #</span><br><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>192.168.84.83<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>192.168.84.83 (192.168.84.83): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.83: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.061 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.83: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.057 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.83: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.047 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.83: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.046 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.83: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.046 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.84.83<span class="built_in"> ping </span>statistics ---</span><br><span class="line">5 packets transmitted, 5 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.046/0.051/0.061 ms</span><br><span class="line">/ #</span><br><span class="line">/ #</span><br><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>192.168.85.83<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>192.168.85.83 (192.168.85.83): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.83: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.092 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.83: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.049 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.83: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.83: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.83: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.057 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.83: <span class="attribute">seq</span>=5 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.049 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.85.83<span class="built_in"> ping </span>statistics ---</span><br><span class="line">6 packets transmitted, 6 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.049/0.057/0.092 ms</span><br><span class="line">/ #</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>

<h2 id="线卡宿主机操作"><a href="#线卡宿主机操作" class="headerlink" title="线卡宿主机操作"></a>线卡宿主机操作</h2><p>创建自定义网络之前，主机环境：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@jamza_vm_lp0_litepaas master]<span class="comment"># ifconfig</span></span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.9.252  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:aeff:feb6:63d3  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:ae:b6:63:d3  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 517 </span> bytes<span class="number"> 32240 </span>(31.4 KiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 244 </span> bytes<span class="number"> 21080 </span>(20.5 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">docker_gwbridge: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.18.0.1  netmask 255.255.240.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:e1ff:fe2d:fc02  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:e1:2d:fc:02  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 6230639 </span> bytes<span class="number"> 324090678 </span>(309.0 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 41 </span> bytes<span class="number"> 2798 </span>(2.7 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.85  netmask 255.255.255.0  broadcast 192.168.83.255</span><br><span class="line">        inet6 fe80::5054:83ff:fecc:dd00  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:cc:dd:00  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 60862286 </span> bytes<span class="number"> 102008047050 </span>(95.0 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 54156229 </span> bytes<span class="number"> 36551403265 </span>(34.0 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth20: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.84.85  netmask 255.255.255.0  broadcast 192.168.84.255</span><br><span class="line">        inet6 fe80::5054:83ff:fecc:dd20  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:cc:dd:20  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 37009669 </span> bytes<span class="number"> 8716621422 </span>(8.1 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13277522 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 15165149 </span> bytes<span class="number"> 13005633643 </span>(12.1 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth21: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.85.85  netmask 255.255.255.0  broadcast 192.168.85.255</span><br><span class="line">        inet6 fe80::5054:83ff:fecc:dd21  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:cc:dd:21  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 6230639 </span> bytes<span class="number"> 324090678 </span>(309.0 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 41 </span> bytes<span class="number"> 2798 </span>(2.7 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen<span class="number"> 128 </span> scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen<span class="number"> 1 </span> (Local Loopback)</span><br><span class="line">        RX packets<span class="number"> 37422659 </span> bytes<span class="number"> 9979561045 </span>(9.2 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 37422659 </span> bytes<span class="number"> 9979561045 </span>(9.2 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line">    </span><br><span class="line">[root@jamza_vm_lp0_litepaas master]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">eae88252b139        bridge              bridge              local</span><br><span class="line">bd5b745fb87f        docker_gwbridge     bridge              local</span><br><span class="line">a20b3d67c74d        host                host                local</span><br><span class="line">d8bdffcb4f6e        none                null                local</span><br></pre></td></tr></table></figure>

<p>创建自定义网络，指定网桥名称为 docker-br0，当然也可以取其他的名字，指定网桥的网段为 172.172.1.0/24：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="title">@jamza_vm_lp0_litepaas</span> master]# docker network create --subnet<span class="operator">=</span><span class="number">172.172</span>.<span class="number">1.0</span>/<span class="number">24</span> docker-<span class="keyword">br</span><span class="number">0</span></span><br><span class="line"><span class="number">563243e33</span>ad<span class="number">94e59</span>bdec<span class="number">3</span>a<span class="number">8</span>cb<span class="number">7</span>b<span class="number">150</span><span class="keyword">c</span><span class="number">1157</span>a<span class="number">7890</span><span class="keyword">c</span><span class="number">13489</span>acd<span class="number">063</span><span class="keyword">c</span><span class="number">23</span><span class="keyword">cc</span><span class="number">2e4</span>f<span class="number">51</span>a</span><br><span class="line">[root<span class="title">@jamza_vm_lp0_litepaas</span> master]#</span><br></pre></td></tr></table></figure>

<p>创建网络后，查看当前主机的网络环境，环境中多出了名称为 br-563243e33ad9 的网卡，且 docker 网络出现刚创建的名称为 docker-br0 的网络：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">[root@jamza_vm_lp0_litepaas master]<span class="comment"># ifconfig</span></span><br><span class="line">br-563243e33ad9: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.172.1.1  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 02:42:54:27:29:5a  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 37009669 </span> bytes<span class="number"> 8716621422 </span>(8.1 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13277522 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 15165149 </span> bytes<span class="number"> 13005633643 </span>(12.1 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.9.252  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:aeff:feb6:63d3  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:ae:b6:63:d3  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 517 </span> bytes<span class="number"> 32240 </span>(31.4 KiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 244 </span> bytes<span class="number"> 21080 </span>(20.5 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">docker_gwbridge: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.18.0.1  netmask 255.255.240.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::42:e1ff:fe2d:fc02  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:e1:2d:fc:02  txqueuelen<span class="number"> 0 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 6230639 </span> bytes<span class="number"> 324090678 </span>(309.0 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 41 </span> bytes<span class="number"> 2798 </span>(2.7 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.83.85  netmask 255.255.255.0  broadcast 192.168.83.255</span><br><span class="line">        inet6 fe80::5054:83ff:fecc:dd00  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:cc:dd:00  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 60862286 </span> bytes<span class="number"> 102008047050 </span>(95.0 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 54156229 </span> bytes<span class="number"> 36551403265 </span>(34.0 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth20: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.84.85  netmask 255.255.255.0  broadcast 192.168.84.255</span><br><span class="line">        inet6 fe80::5054:83ff:fecc:dd20  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:cc:dd:20  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 37009669 </span> bytes<span class="number"> 8716621422 </span>(8.1 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13277522 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 15165149 </span> bytes<span class="number"> 13005633643 </span>(12.1 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">eth21: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.85.85  netmask 255.255.255.0  broadcast 192.168.85.255</span><br><span class="line">        inet6 fe80::5054:83ff:fecc:dd21  prefixlen<span class="number"> 64 </span> scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 52:54:83:cc:dd:21  txqueuelen<span class="number"> 1000 </span> (Ethernet)</span><br><span class="line">        RX packets<span class="number"> 6230639 </span> bytes<span class="number"> 324090678 </span>(309.0 MiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 13 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 41 </span> bytes<span class="number"> 2798 </span>(2.7 KiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen<span class="number"> 128 </span> scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen<span class="number"> 1 </span> (Local Loopback)</span><br><span class="line">        RX packets<span class="number"> 37422659 </span> bytes<span class="number"> 9979561045 </span>(9.2 GiB)</span><br><span class="line">        RX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span> overruns<span class="number"> 0 </span> frame 0</span><br><span class="line">        TX packets<span class="number"> 37422659 </span> bytes<span class="number"> 9979561045 </span>(9.2 GiB)</span><br><span class="line">        TX errors<span class="number"> 0 </span> dropped<span class="number"> 0 </span>overruns<span class="number"> 0 </span> carrier<span class="number"> 0 </span> collisions 0</span><br><span class="line"></span><br><span class="line">[root@jamza_vm_lp0_litepaas master]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">eae88252b139        bridge              bridge              local</span><br><span class="line">563243e33ad9        docker-br0          bridge              local</span><br><span class="line">bd5b745fb87f        docker_gwbridge     bridge              local</span><br><span class="line">a20b3d67c74d        host                host                local</span><br><span class="line">d8bdffcb4f6e        none                null                local</span><br></pre></td></tr></table></figure>

<p>创建容器，并使用自定义的网络，指定容器内的 ip 地址为 172.172.1.10，查看容器内的网络环境，ip 配置为设定值：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@jamza_vm_lp0_litepaas master]# docker run -it --net docker-br0 --ip <span class="number">172.172</span>.<span class="number">1.10</span> --name <span class="keyword">lp</span> busybox/x86_64 /bin/<span class="keyword">sh</span></span><br><span class="line">/ #</span><br><span class="line">/ # ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:AC:AC:<span class="number">01</span>:<span class="number">0</span>A</span><br><span class="line">          inet addr:<span class="number">172.172</span>.<span class="number">1.10</span>  Bcas<span class="variable">t:0</span>.<span class="number">0.0</span>.<span class="number">0</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">42</span>:acff:feac:<span class="number">10</span><span class="keyword">a</span>/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packet<span class="variable">s:12</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packet<span class="variable">s:6</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> carrier:<span class="number">0</span></span><br><span class="line">          collision<span class="variable">s:0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX byte<span class="variable">s:1016</span> (<span class="number">1016.0</span> B)  TX byte<span class="variable">s:508</span> (<span class="number">508.0</span> B)</span><br><span class="line"></span><br><span class="line"><span class="keyword">lo</span>        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packet<span class="variable">s:0</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packet<span class="variable">s:0</span> error<span class="variable">s:0</span> dropped:<span class="number">0</span> overrun<span class="variable">s:0</span> carrier:<span class="number">0</span></span><br><span class="line">          collision<span class="variable">s:0</span> txqueuelen:<span class="number">1</span></span><br><span class="line">          RX byte<span class="variable">s:0</span> (<span class="number">0.0</span> B)  TX byte<span class="variable">s:0</span> (<span class="number">0.0</span> B)</span><br></pre></td></tr></table></figure>

<p>在容器内 ping 当前宿主机的网络地址，显示可以 ping 通：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>192.168.83.85<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>192.168.83.85 (192.168.83.85): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.85: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.046 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.85: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.052 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.85: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.051 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.85: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.83.85: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.83.85<span class="built_in"> ping </span>statistics ---</span><br><span class="line">5 packets transmitted, 5 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.046/0.049/0.052 ms</span><br><span class="line">/ #</span><br><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>192.168.84.85<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>192.168.84.85 (192.168.84.85): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.85: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.044 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.85: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.065 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.85: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.85: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.84.85: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.048 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.84.85<span class="built_in"> ping </span>statistics ---</span><br><span class="line">5 packets transmitted, 5 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.044/0.051/0.065 ms</span><br><span class="line">/ #</span><br><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>192.168.85.85<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>192.168.85.85 (192.168.85.85): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.85: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.089 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.85: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.049 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.85: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.049 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.85: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.85.85: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.050 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.85.85<span class="built_in"> ping </span>statistics ---</span><br><span class="line">5 packets transmitted, 5 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.049/0.057/0.089 ms</span><br><span class="line">/ #</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>

<h2 id="跨主机容器互通"><a href="#跨主机容器互通" class="headerlink" title="跨主机容器互通"></a>跨主机容器互通</h2><p>在主控宿主机上的容器与线卡宿主机上的容器之间互相不能 ping 通：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#主控上的容器ping线卡上的容器</span></span><br><span class="line">/ <span class="meta">#</span></span><br><span class="line">/ <span class="meta"># ping 172.172.1.10</span></span><br><span class="line"><span class="built_in">PING</span> <span class="number">172.172</span><span class="number">.1</span><span class="number">.10</span> (<span class="number">172.172</span><span class="number">.1</span><span class="number">.10</span>): <span class="number">56</span> data bytes</span><br><span class="line">^C</span><br><span class="line">--- <span class="number">172.172</span><span class="number">.1</span><span class="number">.10</span> <span class="built_in">ping</span> statistics ---</span><br><span class="line"><span class="number">3</span> packets transmitted, <span class="number">0</span> packets received, <span class="number">100</span>% packet loss</span><br><span class="line">/ <span class="meta">#</span></span><br><span class="line">/ <span class="meta">#</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#线卡上的容器ping主控上的容器</span></span><br><span class="line">/ <span class="meta">#</span></span><br><span class="line">/ <span class="meta"># ping 172.172.0.10</span></span><br><span class="line"><span class="built_in">PING</span> <span class="number">172.172</span><span class="number">.0</span><span class="number">.10</span> (<span class="number">172.172</span><span class="number">.0</span><span class="number">.10</span>): <span class="number">56</span> data bytes</span><br><span class="line">^C</span><br><span class="line">--- <span class="number">172.172</span><span class="number">.0</span><span class="number">.10</span> <span class="built_in">ping</span> statistics ---</span><br><span class="line"><span class="number">2</span> packets transmitted, <span class="number">0</span> packets received, <span class="number">100</span>% packet loss</span><br><span class="line">/ <span class="meta">#</span></span><br><span class="line">/ <span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p>添加路由规则，在主控宿主机上，设定路由 172.172.1.0/24 网络，经过线卡（192.168.83.85）上的 eth0 物理网桥：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@jamza_vm_master_litepaas master]</span># ip route add <span class="number">172</span>.<span class="number">172</span>.<span class="number">1</span>.<span class="number">0</span>/<span class="number">24</span> via <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">85</span> dev eth0</span><br><span class="line"><span class="string">[root@jamza_vm_master_litepaas master]</span>#</span><br><span class="line"><span class="string">[root@jamza_vm_master_litepaas master]</span># ip route</span><br><span class="line">default via <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">1</span> dev eth0</span><br><span class="line"><span class="number">169.254.0.0</span>/<span class="number">16</span> dev eth0 scope link metric <span class="number">1002</span></span><br><span class="line"><span class="number">169.254.0.0</span>/<span class="number">16</span> dev eth20 scope link metric <span class="number">1003</span></span><br><span class="line"><span class="number">169.254.0.0</span>/<span class="number">16</span> dev eth21 scope link metric <span class="number">1004</span></span><br><span class="line"><span class="number">172.17.6.0</span>/<span class="number">24</span> dev docker0 proto kernel scope link src <span class="number">172</span>.<span class="number">17</span>.<span class="number">6</span>.<span class="number">252</span></span><br><span class="line"><span class="number">172.18.0.0</span>/<span class="number">20</span> dev docker_gwbridge proto kernel scope link src <span class="number">172</span>.<span class="number">18</span>.<span class="number">0</span>.<span class="number">1</span></span><br><span class="line"><span class="number">172.172.0.0</span>/<span class="number">24</span> dev br-760119ea5907 proto kernel scope link src <span class="number">172</span>.<span class="number">172</span>.<span class="number">0</span>.<span class="number">1</span></span><br><span class="line"><span class="number">172.172.1.0</span>/<span class="number">24</span> via <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">85</span> dev eth0</span><br><span class="line"><span class="number">192.168.83.0</span>/<span class="number">24</span> dev eth0 proto kernel scope link src <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">83</span></span><br><span class="line"><span class="number">192.168.84.0</span>/<span class="number">24</span> dev eth20 proto kernel scope link src <span class="number">192</span>.<span class="number">168</span>.<span class="number">84</span>.<span class="number">83</span></span><br><span class="line"><span class="number">192.168.85.0</span>/<span class="number">24</span> dev eth21 proto kernel scope link src <span class="number">192</span>.<span class="number">168</span>.<span class="number">85</span>.<span class="number">83</span></span><br></pre></td></tr></table></figure>

<p>在线卡宿主机上，设定路由 172.172.0.0/24 网络，经过主控（192.168.83.83）上的 eth0 物理网桥：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@jamza_vm_lp0_litepaas master]</span># ip route add <span class="number">172</span>.<span class="number">172</span>.<span class="number">0</span>.<span class="number">0</span>/<span class="number">24</span> via <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">83</span> dev eth0</span><br><span class="line"><span class="string">[root@jamza_vm_lp0_litepaas master]</span>#</span><br><span class="line"><span class="string">[root@jamza_vm_lp0_litepaas master]</span>#</span><br><span class="line"><span class="string">[root@jamza_vm_lp0_litepaas master]</span>#</span><br><span class="line"><span class="string">[root@jamza_vm_lp0_litepaas master]</span># ip route</span><br><span class="line">default via <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">1</span> dev eth0</span><br><span class="line"><span class="number">169.254.0.0</span>/<span class="number">16</span> dev eth0 scope link metric <span class="number">1002</span></span><br><span class="line"><span class="number">169.254.0.0</span>/<span class="number">16</span> dev eth20 scope link metric <span class="number">1003</span></span><br><span class="line"><span class="number">169.254.0.0</span>/<span class="number">16</span> dev eth21 scope link metric <span class="number">1004</span></span><br><span class="line"><span class="number">172.17.9.0</span>/<span class="number">24</span> dev docker0 proto kernel scope link src <span class="number">172</span>.<span class="number">17</span>.<span class="number">9</span>.<span class="number">252</span></span><br><span class="line"><span class="number">172.18.0.0</span>/<span class="number">20</span> dev docker_gwbridge proto kernel scope link src <span class="number">172</span>.<span class="number">18</span>.<span class="number">0</span>.<span class="number">1</span></span><br><span class="line"><span class="number">172.172.0.0</span>/<span class="number">24</span> via <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">83</span> dev eth0</span><br><span class="line"><span class="number">172.172.1.0</span>/<span class="number">24</span> dev br-563243e33ad9 proto kernel scope link src <span class="number">172</span>.<span class="number">172</span>.<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="number">192.168.83.0</span>/<span class="number">24</span> dev eth0 proto kernel scope link src <span class="number">192</span>.<span class="number">168</span>.<span class="number">83</span>.<span class="number">85</span></span><br><span class="line"><span class="number">192.168.84.0</span>/<span class="number">24</span> dev eth20 proto kernel scope link src <span class="number">192</span>.<span class="number">168</span>.<span class="number">84</span>.<span class="number">85</span></span><br><span class="line"><span class="number">192.168.85.0</span>/<span class="number">24</span> dev eth21 proto kernel scope link src <span class="number">192</span>.<span class="number">168</span>.<span class="number">85</span>.<span class="number">85</span></span><br></pre></td></tr></table></figure>

<p>在主控宿主机上的容器与线卡宿主机上的容器之间互相能够 ping 通：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主控上的容器ping线卡上的容器</span></span><br><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>172.172.1.10<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>172.172.1.10 (172.172.1.10): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.1.10: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.492 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.1.10: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.558 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.1.10: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.449 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.1.10: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.491 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.1.10: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.570 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.172.1.10<span class="built_in"> ping </span>statistics ---</span><br><span class="line">5 packets transmitted, 5 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.449/0.512/0.570 ms</span><br><span class="line">/ #</span><br><span class="line"></span><br><span class="line"><span class="comment">#线卡上的容器ping主控上的容器</span></span><br><span class="line">/ #</span><br><span class="line">/ #<span class="built_in"> ping </span>172.172.0.10<span class="built_in"></span></span><br><span class="line"><span class="built_in">PING </span>172.172.0.10 (172.172.0.10): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.0.10: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.458 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.0.10: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.490 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.0.10: <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.430 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.0.10: <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.466 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.0.10: <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.474 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.172.0.10: <span class="attribute">seq</span>=5 <span class="attribute">ttl</span>=62 <span class="attribute">time</span>=0.609 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.172.0.10<span class="built_in"> ping </span>statistics ---</span><br><span class="line">6 packets transmitted, 6 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.430/0.487/0.609 ms</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>
        </div>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/docker/"># docker</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2021/05/22/%E7%9B%B4%E6%8E%A5%E8%B7%AF%E7%94%B1%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0%E8%B7%A8%E4%B8%BB%E6%9C%BADocker%E9%80%9A%E4%BF%A1/">直接路由方式实现跨主机 Docker 通信</a>
            
            
            <a class="next" rel="next" href="/2021/05/22/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E6%A1%A5%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0%E8%B7%A8%E4%B8%BB%E6%9C%BADocker%E9%80%9A%E4%BF%A1/">自定义网桥模式实现跨主机 Docker 通信</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Jamza | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
